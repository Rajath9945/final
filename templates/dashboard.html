<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analytics - {{ session.session_id }}</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet" />
</head>
<body class="bg-slate-900 min-h-screen text-white p-6 md:p-10">

<a href="/" class="text-slate-300 text-sm md:text-base underline mb-4 inline-block">
    &larr; Back to Sessions
</a>

<div class="max-w-6xl mx-auto text-center mb-10" data-aos="zoom-in">
    <h1 class="text-4xl md:text-5xl font-extrabold tracking-wide mb-2">
        üìä Engagement Analytics Dashboard
    </h1>
    <p class="text-slate-300 text-lg">
        Session:
        <span class="font-mono bg-white/10 px-2 py-1 rounded-lg">
            {{ session.session_id }}
        </span>
    </p>
</div>

<!-- Stat Cards -->
<div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
    <div class="stats-card" style="--clr:#c084fc;" data-aos="fade-up">
        <p>Total Samples</p>
        <h2>{{ session.total_emotion_samples or 0 }}</h2>
    </div>
    <div class="stats-card" style="--clr:#60a5fa;" data-aos="fade-up">
        <p>Faces</p>
        <h2>{{ session.total_faces_analyzed or 0 }}</h2>
    </div>
    <div class="stats-card" style="--clr:#4ade80;" data-aos="fade-up">
        <p>Duration (min)</p>
        <h2>{{ session.duration_minutes or 0 }}</h2>
    </div>
    <div class="stats-card" style="--clr:#facc15;" data-aos="fade-up">
        <p>Engagement</p>
        <h2>{{ (stats.engaged_ratio * 100) if stats else 0 }}%</h2>
    </div>
</div>

<!-- Graph + Suggestions -->
<div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">

    <!-- Graph card -->
    <div class="bg-white/10 rounded-3xl p-6 shadow-xl backdrop-blur-xl" data-aos="fade-right">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold">Emotion Analytics</h2>
            <div class="flex gap-2">
                <button onclick="showBar()" class="chart-btn bg-indigo-500">Bar</button>
                <button onclick="showPie()" class="chart-btn bg-pink-500">Pie</button>
                <button onclick="openCompare()" class="chart-btn bg-amber-500">üîÅ Compare</button>
            </div>
        </div>

        <canvas id="emotionBar"></canvas>
        <canvas id="emotionPie" class="hidden"></canvas>
    </div>

    <!-- Suggestions card -->
    <div class="bg-white/10 rounded-3xl p-6 shadow-xl backdrop-blur-xl" data-aos="fade-left">
        <h2 class="text-2xl font-bold mb-3">AI Suggestions for Teacher</h2>
        <ul class="space-y-2 text-sm md:text-base">
            {% for s in suggestions %}
                <li class="bg-white/10 p-3 rounded-xl hover:bg-purple-500/30 transition">
                    {{ s }}
                </li>
            {% endfor %}
        </ul>
    </div>
</div>

<!-- Table -->
<div class="max-w-6xl mx-auto bg-white/10 rounded-3xl p-6 shadow-xl backdrop-blur-xl mb-12"
     data-aos="fade-up">
    <h2 class="text-2xl font-bold mb-4">Session Data Table</h2>
    <table class="w-full text-left text-slate-100 text-sm md:text-base">
        <thead class="bg-white/10">
        <tr>
            <th class="p-3">Emotion</th>
            <th class="p-3">Count</th>
        </tr>
        </thead>
        <tbody>
        {% for label, value in session.emotion_counts.items() %}
            <tr class="border-b border-white/10 hover:bg-white/5 transition">
                <td class="p-3 capitalize">{{ label }}</td>
                <td class="p-3">{{ value }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- Compare Modal -->
<div id="compareModal"
     class="fixed inset-0 bg-black/50 backdrop-blur-md hidden justify-center items-center">
    <div class="bg-slate-800 p-6 rounded-2xl shadow-2xl max-w-md w-full">
        <h2 class="text-xl font-bold text-center mb-4">Select Session to Compare</h2>

        <form action="/compare" method="POST" class="space-y-4">
            <input type="hidden" name="current_session" value="{{ session.session_id }}"/>

            <select name="compare_session"
                    class="w-full p-3 rounded-lg bg-slate-700 text-white border border-slate-500">
                {% for s in session_list %}
                    {% if s.session_id != session.session_id %}
                        <option value="{{ s.session_id }}">{{ s.session_id }}</option>
                    {% endif %}
                {% endfor %}
            </select>

            <div class="flex justify-between mt-4">
                <button type="button" onclick="closeCompare()"
                        class="px-4 py-2 bg-red-500 rounded-lg hover:bg-red-600">
                    Cancel
                </button>
                <button type="submit"
                        class="px-4 py-2 bg-emerald-500 rounded-lg hover:bg-emerald-600">
                    Compare
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Charts JS -->
<script>
    const labels = {{ labels | tojson }};
    const values = {{ values | tojson }};

    const barCtx = document.getElementById("emotionBar");
    const pieCtx = document.getElementById("emotionPie");

    const barChart = new Chart(barCtx, {
        type: "bar",
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: ["#4ade80", "#60a5fa", "#f97373", "#fbbf24", "#c084fc"],
                borderRadius: 12
            }]
        },
        options: {
            responsive: true,
            animation: { duration: 2000, easing: "easeInOutElastic" },
            scales: { y: { beginAtZero: true } }
        }
    });

    const pieChart = new Chart(pieCtx, {
        type: "pie",
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: ["#4ade80", "#60a5fa", "#f97373", "#fbbf24", "#c084fc"]
            }]
        },
        options: {
            responsive: true,
            animation: { duration: 2000, easing: "easeOutBounce" }
        }
    });

    function showBar() {
        barCtx.classList.remove("hidden");
        pieCtx.classList.add("hidden");
    }

    function showPie() {
        pieCtx.classList.remove("hidden");
        barCtx.classList.add("hidden");
    }

    function openCompare() {
        document.getElementById("compareModal").classList.remove("hidden");
    }

    function closeCompare() {
        document.getElementById("compareModal").classList.add("hidden");
    }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
<script>AOS.init();</script>

<style>
    .stats-card {
        background: rgba(15, 23, 42, .85);
        border-radius: 1rem;
        padding: 1rem;
        text-align: center;
        border: 2px solid var(--clr);
        box-shadow: 0 0 25px rgba(0, 0, 0, .5);
    }
    .stats-card p {
        font-size: .9rem;
        color: #e5e7eb;
    }
    .stats-card h2 {
        font-size: 2rem;
        font-weight: 800;
        color: var(--clr);
    }
    .chart-btn {
        padding: 6px 10px;
        font-size: 12px;
        border-radius: 999px;
        transition: .2s;
    }
    .chart-btn:hover {
        transform: translateY(-1px);
        opacity: .9;
    }
</style>

</body>
</html>
